{% assign g_dir   = include.dir | default: '' %}
{% assign g_cols  = include.cols | default: 3 %}
{% assign g_width = include.thumb_width | default: 400 %}
{% assign prefix  = include.id | default: page.url | slugify %}

{% if g_dir == '' %}
  <p style="color:#c00">[gallery] Missing param: <code>dir</code></p>
{% else %}
  {% assign base_path = '/' | append: g_dir | append: '/' %}
  {% assign files = site.static_files | where_exp: "f", "f.path contains base_path" %}
  {% if files == empty %}
    <p>Nessuna immagine trovata in <code>{{ g_dir }}</code>.</p>
  {% else %}
    <div class="gallery-grid" data-gallery="{{ prefix }}">
      {% for image in files %}
        {% assign ext = image.extname | downcase %}
        {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.gif' or ext == '.webp' %}
          <a href="{{ image.path | relative_url }}" 
             class="gallery-item" 
             data-gallery="{{ prefix }}" 
             data-index="{{ forloop.index0 }}">
            <img src="{{ image.path | relative_url }}"
                 alt="{{ image.name | escape }}"
                 width="{{ g_width }}" loading="lazy" decoding="async">
          </a>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
{% endif %}
