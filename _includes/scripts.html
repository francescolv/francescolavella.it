<script src="{{ site.url }}/assets/js/jquery-1.12.2.min.js"></script>
<script src="{{ site.url }}/assets/js/jquery.goup.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $.goup({
        trigger: 500,
        bottomOffset: 10,
        locationOffset: 20,
        containerRadius: 0,
        containerColor: '#fff',
        arrowColor: '#000',
        goupSpeed: 'normal'
    });
});
</script>
{% if site.google.analytics %}
<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', '{{ site.google.analytics }}']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
{% endif %}

<!-- Gallery -->
<script>
  // Chiudi lightbox con ESC
  document.addEventListener('keyup', function(e) {
    if (e.key === "Escape" && window.location.hash.match(/^#lb-/)) {
      history.pushState("", document.title, window.location.pathname + window.location.search);
    }
  });

  // Chiudi cliccando sullo sfondo (non sull'immagine)
  document.addEventListener('click', function(e) {
    var target = e.target;
    if (target.classList && target.classList.contains('lightbox')) {
      e.preventDefault();
      history.pushState("", document.title, window.location.pathname + window.location.search);
    }
  });
</script>
<script>
(function(){
  var lightbox, img, currentIndex, images = [];

  function buildLightbox() {
    lightbox = document.createElement('div');
    lightbox.className = 'lightbox';
    lightbox.innerHTML = `
      <span class="close">&times;</span>
      <img src="" alt="">
      <div class="controls">
        <span class="arrow prev">&#10094;</span>
        <span class="arrow next">&#10095;</span>
      </div>
    `;
    document.body.appendChild(lightbox);
    img = lightbox.querySelector('img');

    // close
    lightbox.querySelector('.close').onclick = close;
    lightbox.onclick = e => { if(e.target === lightbox) close(); };
    // arrows
    lightbox.querySelector('.prev').onclick = prev;
    lightbox.querySelector('.next').onclick = next;
    // esc/keyboard
    document.addEventListener('keyup', e => {
      if (!lightbox.classList.contains('active')) return;
      if (e.key === 'Escape') close();
      if (e.key === 'ArrowLeft') prev();
      if (e.key === 'ArrowRight') next();
    });
  }

  function open(i) {
    currentIndex = i;
    img.src = images[i].href;
    lightbox.classList.add('active');
  }
  function close() { lightbox.classList.remove('active'); }
  function prev() { if (currentIndex > 0) open(currentIndex-1); }
  function next() { if (currentIndex < images.length-1) open(currentIndex+1); }

  document.addEventListener('DOMContentLoaded', function(){
    buildLightbox();
    images = Array.from(document.querySelectorAll('.gallery-item'));
    images.forEach((a, i) => {
      a.addEventListener('click', function(e){
        e.preventDefault();
        open(i);
      });
    });
  });
})();
</script>

